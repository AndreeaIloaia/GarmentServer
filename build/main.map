{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/auth/index.js","webpack:///./src/auth/router.js","webpack:///./src/auth/store.js","webpack:///./src/garment/index.js","webpack:///./src/garment/router.js","webpack:///./src/garment/store.js","webpack:///./src/index.js","webpack:///./src/utils/constants.js","webpack:///./src/utils/index.js","webpack:///./src/utils/middlewares.js","webpack:///./src/utils/wss.js","webpack:///external \"@koa/cors\"","webpack:///external \"http\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-jwt\"","webpack:///external \"koa-router\"","webpack:///external \"nedb-promise\"","webpack:///external \"ws\""],"names":["router","Router","createToken","user","jwt","sign","username","_id","jwtConfig","secret","expiresIn","createUser","response","userStore","insert","body","token","status","err","issue","error","message","post","ctx","request","credentials","findOne","password","UserStore","constructor","filename","autoload","store","dataSource","props","Koa","require","app","server","createServer","callback","WebSocket","wss","Server","createGarment","garment","garmentStore","get","find","id","params","put","updId","updatedCount","update","del","recipe","remove","GarmentStore","dataStore","findAll","garmentName","name","Error","id_random","Math","floor","random","http","initWss","use","cors","timingLogger","exceptionHandler","bodyParser","prefix","publicApiRoutes","authRouter","routes","allowedMethods","protectedApiRouter","garmentRouter","listen","console","log","next","start","Date","now","method","url","value","on","ws","msg","type","payload","JSON","parse","close","verify","broadcast","userId","data","clients","forEach","client","readyState","OPEN","send","stringify"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export * from './router'","import Router from \"koa-router\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport userStore from './store';\r\nimport { jwtConfig } from '../utils';\r\n\r\nexport const router = new Router();\r\n\r\nconst createToken = (user) => {\r\n    return jwt.sign({ username: user.username, _id: user._id }, jwtConfig.secret, { expiresIn: 60 * 60 * 60 });\r\n}\r\n\r\nconst createUser = async (user, response) => {\r\n    try {\r\n        await userStore.insert(user);\r\n        response.body = { token: createToken(user) };\r\n        response.status = 201;\r\n    } catch (err) {\r\n        response.body = { issue: [{ error: err.message }] };\r\n        response.status = 400;\r\n    }\r\n};\r\n\r\nrouter.post('/signup', async (ctx) => await createUser(ctx.request.body, ctx.response));\r\n\r\nrouter.post('/login', async (ctx) => {\r\n    const credentials = ctx.request.body;\r\n    const response = ctx.response;\r\n    const user = await userStore.findOne({ username: credentials.username });\r\n\r\n    if (user && credentials.password === user.password) {\r\n        response.body = { token: createToken(user) };\r\n        response.status = 201;\r\n    } else {\r\n        response.body = { issue: [{ error: 'Invalid credentials' }] };\r\n        response.status = 400;\r\n    }\r\n})","import dataSource from 'nedb-promise';\r\n\r\nexport class UserStore {\r\n    constructor({ filename, autoload }) {\r\n        this.store = dataSource({ filename, autoload })\r\n    }\r\n\r\n    async findOne(props) {\r\n        return this.store.findOne(props);\r\n    }\r\n\r\n    async insert(user) {\r\n        //TODO\r\n        return this.store.insert(user);\r\n    };\r\n}\r\n\r\nexport default new UserStore({ filename: './database/users.json', autoload: true })","export * from './router';","import Router from 'koa-router';\r\nimport garmentStore from './store'\r\n\r\nconst Koa = require('koa');\r\nconst app = new Koa();\r\nconst server = require('http').createServer(app.callback());\r\nconst WebSocket = require('ws');\r\nconst wss = new WebSocket.Server({ server });\r\n\r\nexport const router = new Router();\r\n\r\nconst createGarment = async (ctx, garment, response) => {\r\n    try {\r\n        response.body = await garmentStore.insert(garment);\r\n        response.status = 201;\r\n    } catch (err) {\r\n        response.body = { message : err.message };\r\n        response.status = 400;\r\n    }\r\n};\r\n\r\nrouter.get('/', async (ctx) => {\r\n    const response = ctx.response;\r\n    // ctx.body = 'Merge';\r\n    response.body = await garmentStore.find({});\r\n});\r\n\r\nrouter.get('/:id', async (ctx) => {\r\n    const garment = await garmentStore.findOne({ id: ctx.params.id });\r\n    const response = ctx.response;\r\n    if (garment) {\r\n        response.body = garment;\r\n        response.status = 200; // ok\r\n    } else {\r\n        response.status = 404; // not found\r\n    }\r\n});\r\n\r\nrouter.post('/', async ctx => await createGarment(ctx, ctx.request.body, ctx.response));\r\n\r\nrouter.put('/:id', async (ctx) => {\r\n    const garment = ctx.request.body;\r\n    const id = ctx.params.id;\r\n    const updId = garment.id;\r\n    const response = ctx.response;\r\n    if(updId && updId !== id) {\r\n        response.body = { message: 'Param id and body _id should be the same' };\r\n        response.status = 400;\r\n        return;\r\n    }\r\n    if(!updId)\r\n        await createGarment(ctx, garment, response)\r\n    else {\r\n        const updatedCount = await garmentStore.update({id: id }, garment);\r\n        if (updatedCount === 1) {\r\n            response.body = garment;\r\n            response.status = 200;\r\n        } else {\r\n            response.body = { message: 'Resource no longer exists'};\r\n            response.status = 405;\r\n        }\r\n    }\r\n});\r\n\r\nrouter.del('/:id', async (ctx) => {\r\n    const recipe = await garmentStore.findOne({id: ctx.params.id });\r\n    await garmentStore.remove({ id: ctx.params.id });\r\n    ctx.response.status = 204;\r\n});","import dataStore from 'nedb-promise';\r\n\r\nexport class GarmentStore {\r\n    constructor({filename, autoload}) {\r\n        this.store = dataStore({filename, autoload});\r\n    }\r\n\r\n    async findAll() {\r\n        return this.store.find();\r\n    }\r\n\r\n    async find(props) {\r\n        return this.store.find(props);\r\n    }\r\n\r\n    async findOne(props) {\r\n        return this.store.findOne(props);\r\n    }\r\n\r\n    async insert(garment) {\r\n        let garmentName = garment.name;\r\n        if (!garmentName)\r\n            throw new Error('Missing name property');\r\n        var id_random = \"\" + Math.floor(Math.random() * 1000);\r\n        garment.id = id_random;\r\n        return this.store.insert(garment);\r\n    }\r\n\r\n    async update(props, garment) {\r\n        return this.store.update(props, garment);\r\n    }\r\n\r\n    async remove(props) {\r\n        return this.store.remove(props);\r\n    }\r\n}\r\n\r\nexport default new GarmentStore({filename: './database/garments.json', autoload: true});","import Koa from 'koa';\r\nimport WebSocket from 'ws';\r\nimport http from 'http';\r\nimport Router from 'koa-router';\r\nimport bodyParser from \"koa-bodyparser\";\r\nimport { timingLogger, exceptionHandler, jwtConfig, initWss, verifyClient } from './utils';\r\nimport { router as authRouter } from './auth';\r\nimport { router as garmentRouter } from './garment';\r\nimport jwt from 'koa-jwt';\r\nimport cors from '@koa/cors';\r\n\r\nconst app = new Koa();\r\nconst server = http.createServer(app.callback());\r\nconst wss = new WebSocket.Server({ server });\r\n\r\ninitWss(wss);\r\n\r\napp.use(cors());\r\napp.use(timingLogger);\r\napp.use(exceptionHandler);\r\napp.use(bodyParser());\r\n\r\nconst prefix = '/api';\r\n\r\n//public routes\r\nconst publicApiRoutes = new Router({ prefix });\r\npublicApiRoutes.use('/auth', authRouter.routes());\r\napp.use(publicApiRoutes.routes())\r\n   .use(publicApiRoutes.allowedMethods());\r\n\r\napp.use(jwt(jwtConfig));\r\n\r\n//protected routes\r\nconst protectedApiRouter = new Router({ prefix });\r\nprotectedApiRouter.use('/garment', garmentRouter.routes());\r\napp.use(protectedApiRouter.routes())\r\n    .use(protectedApiRouter.allowedMethods());\r\n\r\nserver.listen(3000);\r\nconsole.log('server started on port 3000');","export const jwtConfig = { secret: 'my-secret' }","export * from './constants';\r\nexport * from './middlewares';\r\nexport * from './wss';","export const exceptionHandler = async (ctx, next) => {\r\n    try {\r\n        return await next();\r\n    } catch (err) {\r\n        ctx.body = { message: err.message || 'Unexpected error.' };\r\n        ctx.status = err.status || 500;\r\n    }\r\n};\r\n\r\nexport const timingLogger = async (ctx, next) => {\r\n    const start = Date.now();\r\n    await next();\r\n    console.log(`${ctx.method} ${ctx.url} => ${ctx.response.status}, ${Date.now() - start} ms`);\r\n};","import WebSocket from \"ws\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport {jwtConfig} from \"./constants\";\r\n\r\nlet wss;\r\n\r\nexport const initWss = value => {\r\n    wss = value;\r\n    wss.on('connection', ws => {\r\n        ws.on('message', msg => {\r\n            const  { type, payload: { token } } = JSON.parse(msg);\r\n            if (type !== 'authorization') {\r\n                ws.close();\r\n                return;\r\n            }\r\n            try {\r\n                ws.user = jwt.verify(token, jwtConfig.secret);\r\n            } catch (err) {\r\n                ws.close();\r\n            }\r\n        })\r\n    });\r\n};\r\n\r\nexport const broadcast = (userId, data) => {\r\n    if (!wss)\r\n        return ;\r\n\r\n    wss.clients.forEach(client => {\r\n        if (client.readyState === WebSocket.OPEN && userId === client.user._id) {\r\n            console.log(`broadcast sent to ${client.user.username}`);\r\n            client.send(JSON.stringify(data));\r\n        }\r\n    });\r\n};","module.exports = require(\"@koa/cors\");","module.exports = require(\"http\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"koa\");","module.exports = require(\"koa-bodyparser\");","module.exports = require(\"koa-jwt\");","module.exports = require(\"koa-router\");","module.exports = require(\"nedb-promise\");","module.exports = require(\"ws\");"],"sourceRoot":""}